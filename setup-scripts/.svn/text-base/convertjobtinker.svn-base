#!/bin/bash
#BASH SCRIPT TO CONVERT THE JOB TRR FILE INTO TINKER XYZ FILES
#param f - The name of the input TRR file
#param o - The name of the output.xvg file

SETRUN_ARGS="$@"
inputfile="benzene_PROD"
outputfile="energy.xvg"

#options passed in from the users
while getopts "f:o:n:" opt; do
        case $opt in
        f )
                inputfile=$OPTARG
                ;;
        o )
                outputfile=$OPTARG
                ;;	
        esac
done

#Make a directory for the invidivual frames if it does not aleady exist
mkdir TinkerXYZ

#Convert the trajectory into a set of pdb files using trjconv
echo 0 | trjconv_d -f ${inputfile}.trr -s ${inputfile}.tpr -o TinkerXYZ/frame.pdb -sep -pbc whole

#Convert each pdb file into a tinker XYZ file and add in the atom types
cd TinkerXYZ
for file in $(ls *.pdb); do 
	echo $file | pdbxyz
done

#Add appropriate atom types to each xyz file
for file in $(ls *.xyz); do
	sed '/C/ s/   0  /   217  /g' 	#Carbon
	sed '/H/ s/   0  /   218  /g'   #Hydrogen
done
cd ..

