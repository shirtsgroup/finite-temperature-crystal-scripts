#/usr/bin/python
#PYTHON SCRIPT TO TAKE IN AN XVG FILE AND CREATE A MOVING AVERAGE OF THE SAME DATA
import numpy # numerical array library
import pymbar # multistate Bennett acceptance ratio
from pymbar import timeseries # timeseries analysis
from optparse import OptionParser # for parsing command-line options
import pdb

#=============================================================================================
# READ IN USER INPUTS
#=============================================================================================
parser = OptionParser()
parser.add_option('-f', dest = 'infile', help = 'Input xvg file')
(options, args) = parser.parse_args()

ignore_symbols = ['#', '@', '@TYPE', 'STEP', '====================='];
fname = str(options.infile)
infile = open(fname,'r')
lines = infile.readlines()
infile.close()
print "loading " + str(fname)
fname = str(options.infile)+'_avg.xvg'
outfile = open(fname, 'w')

counter = 0
movingavg = 0
for line in lines:
    tokens = line.split()
    if tokens[0] in ignore_symbols:
	outfile.write(line)
	continue
    movingavg = movingavg*float(counter)/(counter+1)+1.0/(counter+1)*float(tokens[1])
    outfile.write(str(tokens[0]) + ' ' + str(movingavg) + '\n')
    counter+=1
